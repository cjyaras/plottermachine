\documentclass[12pt]{article}

\usepackage[letterpaper, margin=1.0in]{geometry}
\usepackage{appendix}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{siunitx}
\usepackage{caption}
\usepackage{moreverb}
\usepackage{parskip}
\usepackage{multirow}
\usepackage{adjustbox}
\usepackage{enumerate}
\usepackage{listings}
\usepackage{graphicx}
\usepackage{pdfpages}
\usepackage[american,straightlabels]{circuitikz}
\usepackage{fancyhdr}
\usepackage[explicit]{titlesec}
\usepackage{xcolor}
\usepackage[many]{tcolorbox}
\usepackage{eqparbox}
\usepackage{hyperref}
\usepackage{listings}

\lstdefinelanguage[mips]{Assembler}{%
  % so listings can detect directives and register names
  alsoletter={.\$},
  % strings, characters, and comments
  morestring=[b]",
  morestring=[b]',
  morecomment=[l]\#,
  % instructions
  morekeywords={[1]abs,abs.d,abs.s,add,add.d,add.s,addi,addiu,addu,%
    and,andi,b,bc1f,bc1t,beq,beqz,bge,bgeu,bgez,bgezal,bgt,bgtu,%
    bgtz,ble,bleu,blez,blt,bltu,bltz,bltzal,bne,bnez,break,c.eq.d,%
    c.eq.s,c.le.d,c.le.s,c.lt.d,c.lt.s,ceil.w.d,ceil.w.s,clo,clz,%
    cvt.d.s,cvt.d.w,cvt.s.d,cvt.s.w,cvt.w.d,cvt.w.s,div,div.d,div.s,%
    divu,eret,floor.w.d,floor.w.s,j,jal,jalr,jr,l.d,l.s,la,lb,lbu,%
    ld,ldc1,lh,lhu,li,ll,lui,lw,lwc1,lwl,lwr,madd,maddu,mfc0,mfc1,%
    mfc1.d,mfhi,mflo,mov.d,mov.s,move,movf,movf.d,movf.s,movn,movn.d,%
    movn.s,movt,movt.d,movt.s,movz,movz.d,movz.s,msub,msubu,mtc0,mtc1,%
    mtc1.d,mthi,mtlo,mul,mul.d,mul.s,mulo,mulou,mult,multu,mulu,neg,%
    neg.d,neg.s,negu,nop,nor,not,or,ori,rem,remu,rol,ror,round.w.d,%
    round.w.s,s.d,s.s,sb,sc,sd,sdc1,seq,sge,sgeu,sgt,sgtu,sh,sle,%
    sleu,sll,sllv,slt,slti,sltiu,sltu,sne,sqrt.d,sqrt.s,sra,srav,srl,%
    srlv,sub,sub.d,sub.s,subi,subiu,subu,sw,swc1,swl,swr,syscall,teq,%
    teqi,tge,tgei,tgeiu,tgeu,tlt,tlti,tltiu,tltu,tne,tnei,trunc.w.d,%
    trunc.w.s,ulh,ulhu,ulw,ush,usw,xor,xori,setx,bex},
  % assembler directives
  morekeywords={[2].align,.ascii,.asciiz,.byte,.data,.double,.extern,%
    .float,.globl,.half,.kdata,.ktext,.set,.space,.text,.word},
  % register names
  morekeywords={[3]\$0,\$1,\$2,\$3,\$4,\$5,\$6,\$7,\$8,\$9,\$10,\$11,%
    \$12,\$13,\$14,\$15,\$16,\$17,\$18,\$19,\$20,\$21,\$22,\$23,\$24,%
    \$25,\$26,\$27,\$28,\$29,\$30,\$31,%
    \$zero,\$at,\$v0,\$v1,\$a0,\$a1,\$a2,\$a3,\$t0,\$t1,\$t2,\$t3,\$t4,
    \$t5,\$t6,\$t7,\$s0,\$s1,\$s2,\$s3,\$s4,\$s5,\$s6,\$s7,\$t8,\$t9,%
    \$k0,\$k1,\$gp,\$sp,\$fp,\$ra},
}[strings,comments,keywords]

\lstdefinestyle{myVerilog}{
  language=Verilog,
  basicstyle=\tiny,
  frame=shadowbox,                    
  rulesepcolor=\color{blue}
}

\lstdefinestyle{myMips}{
  language=[mips]Assembler,
  basicstyle=\tiny,
  frame=shadowbox,                    
  rulesepcolor=\color{blue}
}

\hypersetup{
    colorlinks=true,
    linkcolor=black,
    filecolor=magenta,      
    urlcolor=blue,
}

\pagestyle{fancy}

\renewcommand{\headrulewidth}{0.2mm}
\renewcommand{\footrulewidth}{0.2mm}

\fancyhead[L]{ECE 350}
\fancyhead[R]{Page \thepage}
\fancyfoot[L]{Final Project}
\fancyfoot[C]{Carreiro, Yaras}
\fancyfoot[R]{Page \thepage}

\def\arraystretch{1.5}

\begin{document}
\title{ECE 350 Final Project}
\author{Januario Carreiro and John Yaras}
\date{\today}

\maketitle

\thispagestyle{fancy}

\newpage

\section{Project Design and Specifications}
For the final project, we decided to build and implement an XY--Plotter, which is a device that can guide a pen along two axes in order to create an image on a piece of paper. For the hardware, we settled on the <KIT NAME> as a starting point. This kit included the mechanisms necessary to draw on two axes, and we would go on to add a mechanism to lift and lower our writing instrument.

\begin{table}[ht!]
\centering
\begin{tabular}{|c|c|} \hline
Part & Quantity \\ \hline \hline
Stepper Motor & 2 \\ \hline
\end{tabular}
\caption{Parts List}
\end{table}


\section{Input and Output}
There are two ways to declare inputs and outputs: manually or <TO BE DETERMINED> % FIX

To communicate with the FPGA manually, the four buttons on the FPGA can be used:

\begin{table}[ht!]
\centering
\begin{tabular}{|c|c|} \hline
Button & Result \\ \hline \hline
 & Forward \\ \hline
 & Backward \\ \hline
 & Leftward \\ \hline
 & Rightward \\ \hline
\end{tabular}
\end{table}

These buttons can be combined in order to move the pen diagonally in any direction.

To give instructions to the FPGA, a system similar to the one used by Logo is used:

\begin{table}[ht!]
\centering
\begin{tabular}{|c|c|c|c|c|c|c|c|c|} \hline
OP & B7 & B6 & B5 & B4 & B3 & B2 & B1 & B0 \\ \hline
\end{tabular}
\caption{Instruction Format}
\end{table}



\section{Changes to Processor}
No changes to the processor were made. The only addition to the processor that would have been useful would have been the capability to do floating point math. However, adding support for floating points was deemed to be an irresponsible use of time given the time constraints, so we used a system of lookup tables (with significant multipliers) inserted into the DMEM in order to get around the need for floating point math.

\section{Challenges Faced}
% First chose an inverse speed system
% Switched to using lookup tables

\section{Testing}

\newpage
\section{Programs/Code}

\begin{lstlisting}[language=python, caption={Python Code for generating Lookup Tables in dmem.mif}, captionpos=b]
import math
... 
f = open("dmem.mif","w+")
for i in range(360):
  sinBin="{0:032b}".format(round(multAngle*math.sin(radi*i))&0xffffffff)
  f.write("%d : %s ;\n"%(offsetSin+i,sinBin))
...
for i in range(360):
  if round(fm * math.sin(radi * i)) == 0 : # cannot divide by zero
    fx="{0:032b}".format(abs(round(fm*math.sin(radi*i))))
  else :
    fx="{0:032b}".format(round(fc/(2*abs(fm*math.sin(radi*i)))))
  f.write("%d : %s ;\n"%(offsetFx+i,fx))
...
f.write("END;\n")
f.close()
\end{lstlisting}


\section{Possible Improvements/Features}

\section{Images}

%A PDF on Gradescope
%Kind of like a lab report but longer
%Expecting about 8 to 10 pages
%Describe the overall project design and specifications
%Describe input and output
%Changes you had to make to your processor
%Challenges you faced and how you overcame them
%Any circuit diagrams, how you constructed them, and the rationale behind them
%Describe how you tested your project
%Describe your assembly programs or code
%What improvements you would make / new features you would add if you had more time
%Pictures of your project

\begin{figure}[ht!]
\begin{center}
\begin{circuitikz}
\ctikzset{multipoles/thickness=3}
\ctikzset{multipoles/dipchip/width=2}
\draw (0,0) node[dipchip, num pins=16, hide numbers, no topmark, external pins width=0](C){SMD};
\node [right, font=\tiny] at (C.bpin 1) {ENABLE};
\node [right, font=\tiny] at (C.bpin 2) {M0};
\node [right, font=\tiny] at (C.bpin 3) {M1};
\node [right, font=\tiny] at (C.bpin 4) {M2};
\node [right, font=\tiny] at (C.bpin 5) {RESET};
\node [right, font=\tiny] at (C.bpin 6) {SLEEP};
\node [right, font=\tiny] at (C.bpin 7) {STEP};
\node [right, font=\tiny] at (C.bpin 8) {DIR};
\node [left, font=\tiny] at (C.bpin 16) {VMOT};
\node [left, font=\tiny] at (C.bpin 15) {GND};
\node [left, font=\tiny] at (C.bpin 14) {B2};
\node [left, font=\tiny] at (C.bpin 13) {B1};
\node [left, font=\tiny] at (C.bpin 12) {A1};
\node [left, font=\tiny] at (C.bpin 11) {A2};
\node [left, font=\tiny] at (C.bpin 10) {VDD};
\node [left, font=\tiny] at (C.bpin 9) {GND};
\draw (C.bpin 5) 	to[short] ++ (-1,0) node(n1) {};
\draw (C.bpin 6) 	to[short] ++ (-1,0) 
					to[short] (n1);
\draw (C.bpin 7) 	to[short, -o] ++ (-2,0) node[anchor=east] {DIG 7}; % UPDATE
\draw (C.bpin 8) 	to[short, -o] ++ (-2,0) node[anchor=east] {DIG 8}; % UPDATE
\draw (C.bpin 9) 	to[short] ++ (1,0) 
					to[short] ++ (0,-1) node(n2) {}
					to[short] (n2 -| n1) 
					to[short, -o] ++(-1,0) node[anchor=east] {5V}; % UPDATE
\draw (C.bpin 10) 	to[short] ++ (1.6,0) node(n3) {}
					to[short] (n3 |- n2)
					to[short] ++(0,-.6) node(n4) {}
					to[short] (n4 -| n1) 
					to[short, -o] ++(-1,0) node[anchor=east] {GND}; % UPDATE
\draw (C.bpin 11) 	to[short, -o] ++ (2,0) node[anchor=west] {PHASE /A};
\draw (C.bpin 12) 	to[short, -o] ++ (2,0) node[anchor=west] {PHASE A};
\draw (C.bpin 13) 	to[short, -o] ++ (2,0) node[anchor=west] {PHASE /B};
\draw (C.bpin 14) 	to[short, -o] ++ (2,0) node[anchor=west] {PHASE B};
\draw (C.bpin 15) 	to[short] ++ (4,0) 
					to[short] ++ (0,2) node(n5) {}
					to[short, -o] ++ (0,1) node[anchor=south] {GND};
\draw (C.bpin 16) 	to[short] ++ (2,0) node(n6) {}
					to[short] (n6 |- n5) node(n7) {}
					to[C, l_=\SI{47}{\nano\farad}] (n5);
\draw (n7)			to[short, -o] ++(0,1) node[anchor=south] {VDD};
\end{circuitikz}
\end{center}
\caption{Circuit Diagram for Stepper Motor Drivers}
\end{figure}

\begin{figure}[ht!]
\begin{center}
\begin{circuitikz}
\ctikzset{multipoles/thickness=3}
\ctikzset{multipoles/dipchip/width=2}
\draw (0,0) node[dipchip, num pins=16, hide numbers, no topmark, external pins width=0](C){FPGA};
\end{circuitikz}
\caption{Circuit Diagram for FPGA Outputs}
\end{center}
\end{figure}

\end{document}
